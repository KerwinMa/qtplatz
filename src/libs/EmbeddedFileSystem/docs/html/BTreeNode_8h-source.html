<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>EmbeddedFileSystem: BTreeNode.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>BTreeNode.h</h1><div class="fragment"><pre>00001 
00002 
00003 
00004 
00005 
00006 
00007 
00008 
00009 <span class="preprocessor">#ifndef __BTreeNode_h__</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#define __BTreeNode_h__</span>
00011 <span class="preprocessor"></span>
00012 <span class="preprocessor">#include "PlatformTypes.h"</span>
00013 <span class="preprocessor">#include "BTreeElement.h"</span>
00014 
00018 
00019 <span class="preprocessor">#pragma pack( 1 )</span>
00020 <span class="preprocessor"></span><span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
<a name="l00021"></a><a class="code" href="classBTreeNode.html">00021</a> <span class="keyword">class </span><a class="code" href="classBTreeNode.html">BTreeNode</a>
00022 {
00023 <span class="keyword">public</span>:
00024 
00025         <span class="keyword">enum</span> Flags
00026         {
00027                 NodeChanged = 1
00028         };
00029 
00030         <span class="keyword">typedef</span> <a class="code" href="classBTreeElement.html">BTreeElement&lt; KeyT, DataT &gt;</a> <a class="code" href="classBTreeElement.html">ElemType</a>;
00031 
00032         <a class="code" href="classBTreeNode.html">BTreeNode</a>();
00033         ~<a class="code" href="classBTreeNode.html">BTreeNode</a>();
00034 
00035         <span class="keyword">inline</span> <span class="keywordtype">int</span> add( <span class="keyword">const</span> KeyT &amp;key, <span class="keyword">const</span> DataT &amp;data );
00036         <span class="keywordtype">int</span> add( <span class="keyword">const</span> <a class="code" href="classBTreeElement.html">ElemType</a> &amp;elem );
00037 
00038         <span class="keywordtype">void</span> removeAt( <span class="keywordtype">int</span> index );
00039         <span class="keywordtype">void</span> removeAt( <span class="keywordtype">int</span> index, <a class="code" href="classBTreeElement.html">ElemType</a> &amp;removed );
00040 
00041         <span class="keywordtype">void</span> clear();
00042 
00043         <span class="keywordtype">bool</span> find( <span class="keyword">const</span> KeyT &amp;key, <span class="keywordtype">int</span> &amp;index ) <span class="keyword">const</span>;
00044 
00045         <span class="keywordtype">bool</span> hasChilds() <span class="keyword">const</span>;
00046         <span class="keywordtype">bool</span> isEmpty() <span class="keyword">const</span>;
00047         <span class="keywordtype">bool</span> isFull() <span class="keyword">const</span>;
00048 
00049         <span class="keywordtype">int</span> count() <span class="keyword">const</span>;
00050 
00051         <span class="keyword">enum</span> { maxKeys = NodeSize };
00052 
00053 <span class="comment">// Data</span>
00054 
00055         <span class="keywordtype">int</span> addr_;
00056 
00057         <span class="keywordtype">int</span> less_;
00058         <a class="code" href="classBTreeElement.html">ElemType</a> elems_[ NodeSize ];
00059         <span class="keywordtype">int</span> size_;
00060         <span class="keywordtype">int</span> parent_;
00061         gbyte flags_;
00062 };
00063 <span class="preprocessor">#pragma pack()</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#include "string.h"</span>
00066 
00067 <span class="comment">//      ===================================================================</span>
00068 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::BTreeNode</span>
00069 
00070 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00071 <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::BTreeNode</a>()
00072 :       addr_( 0 ),
00073         less_( 0 ),
00074         size_( 0 ),
00075         parent_( 0 ),
00076         flags_( 0 )
00077 {
00078         <span class="comment">// Clear RAM garbage</span>
00079         ::memset( &amp;elems_, 0, <span class="keyword">sizeof</span>( ElemType )*NodeSize );
00080 }
00081 
00082 <span class="comment">//      ===================================================================</span>
00083 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::~BTreeNode</span>
00084 
00085 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00086 <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::~BTreeNode</a>()
00087 {}
00088 
00089 <span class="comment">//      ===================================================================</span>
00090 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::add</span>
00091 
00092 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00093 <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::add</a>( <span class="keyword">const</span> KeyT &amp;key, <span class="keyword">const</span> DataT &amp;data )
00094 {
00095         <span class="keywordtype">bool</span> added = <span class="keyword">false</span>;
00096 
00097         <span class="keywordtype">int</span> i = 0;
00098         <span class="keywordflow">for</span> ( i = 0; i &lt; size_; i++ )
00099         {
00100                 <span class="keywordflow">if</span> ( elems_[ i ].<a class="code" href="classBTreeElement.html#o0">key_</a> &gt; key )
00101                 {
00102                         <span class="comment">// Move all greater elems</span>
00103                         ::memmove( elems_ + i + 1, elems_ + i, 
00104                                 ( size_ - i )*<span class="keyword">sizeof</span>( ElemType ) );
00105 
00106                         <span class="comment">// Assign new value</span>
00107                         elems_[ i ].<a class="code" href="classBTreeElement.html#o0">key_</a> = key;
00108                         elems_[ i ].<a class="code" href="classBTreeElement.html#o1">data_</a> = data;
00109                         elems_[ i ].<a class="code" href="classBTreeElement.html#o2">link_</a> = 0;
00110                         added = <span class="keyword">true</span>;
00111                         <span class="keywordflow">break</span>;
00112                 }
00113         }
00114 
00115         <span class="keywordflow">if</span> ( !added )
00116         {
00117                 elems_[ size_ ].<a class="code" href="classBTreeElement.html#o0">key_</a> = key;
00118                 elems_[ size_ ].<a class="code" href="classBTreeElement.html#o1">data_</a> = data;
00119                 i = size_;
00120         }
00121 
00122         size_++;
00123         flags_ = NodeChanged;
00124         <span class="keywordflow">return</span> i;
00125 }
00126 
00127 <span class="comment">//      ===================================================================</span>
00128 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::add</span>
00129 
00130 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00131 <span class="keywordtype">int</span> BTreeNode&lt; NodeSize, KeyT, DataT &gt;::add( <span class="keyword">const</span> <span class="keyword">typename</span> ElemType &amp;elem )
00132 {
00133         <span class="keywordtype">int</span> index = add( elem.key_, elem.data_ );
00134         elems_[ index ].<a class="code" href="classBTreeElement.html#o2">link_</a> = elem.link_;
00135         <span class="keywordflow">return</span> index;
00136 }
00137 
00138 <span class="comment">//      ===================================================================</span>
00139 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::removeAt</span>
00140 
00141 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00142 <span class="keywordtype">void</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::removeAt</a>( <span class="keywordtype">int</span> index )
00143 {
00144         elems_[ index ] = ElemType();
00145         ::memmove( elems_ + index, elems_ + index + 1, 
00146                 ( size_ - index - 1 )*<span class="keyword">sizeof</span>( ElemType ) );
00147 
00148         size_--;
00149         flags_ = NodeChanged;
00150 }
00151 
00152 <span class="comment">//      ===================================================================</span>
00153 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::removeAt</span>
00154 
00155 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00156 <span class="keywordtype">void</span> BTreeNode&lt; NodeSize, KeyT, DataT &gt;::removeAt( <span class="keywordtype">int</span> index, 
00157                                                                         <span class="keyword">typename</span> ElemType &amp;removed )
00158 {
00159         removed = elems_[ index ];
00160         elems_[ index ] = ElemType();
00161 
00162         ::memmove( elems_ + index, elems_ + index + 1, 
00163                 ( size_ - index - 1 )*<span class="keyword">sizeof</span>( ElemType ) );
00164 
00165         size_--;
00166         flags_ = NodeChanged;
00167 }
00168 
00169 <span class="comment">//      ===================================================================</span>
00170 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::clear</span>
00171 
00172 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00173 <span class="keywordtype">void</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::clear</a>()
00174 {
00175         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; size_; i++ )
00176         {
00177                 elems_[ i ] = ElemType();
00178         }
00179 
00180         size_ = 0;
00181         flags_ = 0;
00182 }
00183 
00184 <span class="comment">//      ===================================================================</span>
00185 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::find</span>
00186 
00187 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00188 <span class="keywordtype">bool</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::find</a>( <span class="keyword">const</span> KeyT &amp;key, <span class="keywordtype">int</span> &amp;index )<span class="keyword"> const</span>
00189 <span class="keyword"></span>{
00190         <span class="keywordtype">int</span> lb = 0, ub = size_ - 1;
00191 
00192         <span class="keywordflow">while</span>( lb &lt;= ub )
00193         {
00194                 index = ( lb + ub ) &gt;&gt; 1;
00195 
00196                 <span class="keywordflow">if</span>( key &lt; elems_[ index ].<a class="code" href="classBTreeElement.html#o0">key_</a> )
00197                 {
00198                         ub = index - 1;
00199                 }
00200                 <span class="keywordflow">else</span>
00201                 {
00202                         <span class="keywordflow">if</span>( key &gt; elems_[ index ].key_ )
00203                         {
00204                                 lb = index + 1;
00205                         }
00206                         <span class="keywordflow">else</span>
00207                         {
00208                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00209                         }
00210                 }
00211         }
00212 
00213         index = lb;
00214         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00215 }
00216 
00217 <span class="comment">//      ===================================================================</span>
00218 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::hasChilds</span>
00219 
00220 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00221 <span class="keywordtype">bool</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::hasChilds</a>()<span class="keyword"> const</span>
00222 <span class="keyword"></span>{
00223         <span class="keywordflow">return</span> less_ != 0;
00224 }
00225 
00226 <span class="comment">//      ===================================================================</span>
00227 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::isEmpty</span>
00228 
00229 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00230 <span class="keywordtype">bool</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::isEmpty</a>()<span class="keyword"> const</span>
00231 <span class="keyword"></span>{
00232         <span class="keywordflow">return</span> size_ == 0;
00233 }
00234 
00235 <span class="comment">//      ===================================================================</span>
00236 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::isFull</span>
00237 
00238 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00239 <span class="keywordtype">bool</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::isFull</a>()<span class="keyword"> const</span>
00240 <span class="keyword"></span>{
00241         <span class="keywordflow">return</span> size_ == maxKeys;
00242 }
00243 
00244 <span class="comment">//      ===================================================================</span>
00245 <span class="comment">//      BTreeNode&lt; NodeSize, KeyT, DataT &gt;::count</span>
00246 
00247 <span class="keyword">template</span>&lt; <span class="keywordtype">int</span> NodeSize, <span class="keyword">typename</span> KeyT, <span class="keyword">typename</span> DataT &gt;
00248 <span class="keywordtype">int</span> <a class="code" href="classBTreeNode.html">BTreeNode&lt; NodeSize, KeyT, DataT &gt;::count</a>()<span class="keyword"> const</span>
00249 <span class="keyword"></span>{
00250         <span class="keywordflow">return</span> size_;
00251 }
00252 
00253 <span class="preprocessor">#endif // __BTreeNode_h__</span>
00254 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Oct 18 11:38:49 2007 for EmbeddedFileSystem by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
